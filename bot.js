const Discord = require("discord.js");
const client = new Discord.Client();
const invites = {};
const wait = require('util').promisify(setTimeout);
client.on('ready', () => {
  client.user.setGame('.help | By:7assawi.SA','https://www.twitch.tv/TEST-Broadcast');
  console.log('---------------');
  console.log(' Bot Is Online')
  console.log('---------------')
});
client.on('guildMemberAdd', member => {
    const botCount = member.guild.members.filter(m=>m.user.bot).size
    const memberCount = [member.guild.memberCount] - [botCount]
    client.channels.get('531778654976606218').setName(`âŸ«ã€Ž ${memberCount} Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡ ã€âŸª`);
    client.channels.get('531778715529510925').setName(`âŸ«ã€Ž ${botCount} Ø¹Ø¯Ø¯ Ø§Ù„Ø¨ÙˆØªØ§Øª ã€âŸª`);
});
client.on('guildMemberRemove', member => {
    const botCount = member.guild.members.filter(m=>m.user.bot).size
    const memberCount = [member.guild.memberCount] - [botCount]
    client.channels.get('531778654976606218').setName(`âŸ«ã€Ž ${memberCount} Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡ ã€âŸª`);
    client.channels.get('531778715529510925').setName(`âŸ«ã€Ž ${botCount} Ø¹Ø¯Ø¯ Ø§Ù„Ø¨ÙˆØªØ§Øª ã€âŸª`);
});
client.on('guildMemberAdd', Sal => { //By Salto7#4595
    var embed = new Discord.RichEmbed()
    .setAuthor(Sal.user.username, Sal.user.avatarURL)
    .setThumbnail(Sal.user.avatarURL)
    .addField('``ðŸ†” Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø¶Ùˆ``:',"" +  Sal.user.id, true)
    .addField('``ðŸ”–ØªØ§Ù‚ Ø§Ù„Ø¹Ø¶Ùˆ``', Sal.user.discriminator, true)
    .addField('``ðŸ“… ØªÙ… Ø§Ù„Ø§Ù†Ø´Ø§Ø¡ ÙÙŠ``', Sal.user.createdAt, true)
    .addField(' ðŸ‘¤  Ø§Ù†Øª Ø±Ù‚Ù…',`**[ ${Sal.guild.memberCount} ]**`,true)
    .setColor('RANDOM')
    .setFooter(Sal.guild.name, Sal.guild.iconURL, true)
    var channel =Sal.guild.channels.find('name', 'welcomeðŸ¡')
    if (!channel) return;
    channel.send({embed : embed});
    });

client.on('message', msg => {
if (msg.content === '.help') {
    msg.reply(':envelope: | ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ù‡ ÙÙŠ Ø§Ù„Ø®Ø§Øµ');
  }
});

client.on('message', msg => {
if (msg.content === '.ip') {
    msg.reply('RinoZone.tk');
  }
});

client.on("message", message => {
    var prefix = ".";
 
            var args = message.content.substring(prefix.length).split(" ");
            if (message.content.startsWith(prefix + "clear")) {
   if(!message.member.hasPermission('MANAGE_MESSAGES')) return message.reply('**Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª**');
        var msg;
        msg = parseInt();
      
      message.channel.fetchMessages({limit: msg}).then(messages => message.channel.bulkDelete(messages)).catch(console.error);
      message.channel.sendMessage("", {embed: {
        title: "Done | ØªÙ€Ù€Ù…",
        color: 0x06DF00,
        description: "ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø¬Ø§Ø­",
		
      }}).then(msg => {msg.delete(3000)});
			}
});
 client.on('message' , message => {
	 if (message.content === '.help') {
              var embed  = new Discord.RichEmbed()
                .addField("**.help**" ,"ÙŠØ¹Ù„Ù…Ùƒ Ø§ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙˆØª")
				.addField("**.ping**" ,"ÙŠØ¹Ù„Ù…Ùƒ Ø¨Ù†Ù‚Ùƒ")
				.addField("**.id**" ,"ÙŠØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙÙŠÙ‡Ø§ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ")
				.addField("**.avatar**" ,"ÙŠØ±Ø³Ù„ Ø±Ø§Ø¨Ø· ÙÙŠÙ‡ ØµÙˆØ±Øª Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ùƒ")
								.addField("**.new**" ,"ØªÙØªØ­ ØªØ°ÙƒØ±Ø©")
												.addField("**.close**" ,"ØªØ³ÙƒØ± ØªØ°ÙƒØ±Ø©")
.addField("**.ip**" ,"ÙŠØ±Ø³Ù„Ùƒ Ø§ÙŠ Ø¨ÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±")
.setColor('RANDOM')
  message.author.sendEmbed(embed);
 }
 });
client.on("message", message => {
      if (message.content === ".ping") {
      const embed = new Discord.RichEmbed()
  .setColor("RANDOM")
  .addField('**Ping:**' , `${Date.now() - message.createdTimestamp}` + ' ms')
  message.channel.sendEmbed(embed);
	  }
});
client.on('message', message => {
     if (message.content === ".id") {
     let embed = new Discord.RichEmbed()
  .setThumbnail(message.author.avatarURL) 
  .setColor("#9B59B6")
  .addField("Ø§Ø³Ù€Ù€Ù€Ù… Ø§Ù„Ø­Ø³Ù€Ù€Ø§Ø¨", `${message.author.username}`)
  .addField('ÙƒÙˆØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®Ø§Øµ', message.author.discriminator)
  .addField("Ø§Ù„Ø±Ù‚Ù€Ù€Ù€Ù… Ø§Ù„Ø´Ù€Ù€Ù€Ø®ØµÙŠ", message.author.id)
  .addField("ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„", message.author.createdAt)
     
     
  message.channel.sendEmbed(embed);
    }
});
client.on("message", (message) => {
    if (message.content.startsWith(".ban ")) {
      if(!message.member.hasPermission('BAN_MEMBERS')) return message.reply('âš  Ù…Ø§Ø¹Ù†Ø¯Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª');
        var member= message.mentions.members.first();
        member.ban().then((member) => {
            message.channel.send(member.displayName + " Ù„Ù‚Ø¯ ØªÙ… Ø·Ø±Ø¯Ù‡ Ø¨Ù†Ø¬Ø§Ø­ :wave: ");
        }).catch(() => {
            message.channel.send(":x: Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø§Ø¡ Ø­Ø§ÙˆÙ„ Ù…Ø±Ù‡ Ø£Ø®Ø±Ù‰:x: ");
        });
    }
});
client.on('message', message => {
    if (message.content === ".avatar") {
    message.reply(message.author.avatarURL); 
    }
});
var prefix = ".";
client.on('message', message => {
  if (message.author.bot) return;
  if (!message.content.startsWith(prefix)) return;

  let command = message.content.split(" ")[0];
  command = command.slice(prefix.length);

  let args = message.content.split(" ").slice(1);

  if (command == "say") {
	  var embed = new Discord.RichEmbed()
   message.channel.sendMessage(args.join("  "))
  }
});
client.on("message", (message) => {
   if (message.content.startsWith(".new")) {     
        const reason = message.content.split(" ").slice(1).join(" ");     
        if (!message.guild.roles.exists("name", "Support Team")) return message.channel.send(`This server doesn't have a \`Support Team\` role made, so the ticket won't be opened.\nIf you are an administrator, make one with that name exactly and give it to users that should be able to see tickets.`);
        if (message.guild.channels.exists("name", "ticket-{message.author.id}" + message.author.id)) return message.channel.send(`You already have a ticket open.`);    
        message.guild.createChannel(`ticket-${message.author.username}`, "text").then(c => {
            let role = message.guild.roles.find("name", "Support Team");
            let role2 = message.guild.roles.find("name", "@everyone");
            c.overwritePermissions(role, {
                SEND_MESSAGES: true,
                READ_MESSAGES: true
            });    
            c.overwritePermissions(role2, {
                SEND_MESSAGES: false,
                READ_MESSAGES: false
            });
            c.overwritePermissions(message.author, {
                SEND_MESSAGES: true,
                READ_MESSAGES: true
            });
            message.channel.send(`:white_check_mark: **ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªØ°ÙƒØ±ØªÙƒ ØŒ #${c.name}.**`);
            const embed = new Discord.RichEmbed()
                .setColor(0xCF40FA)
                .addField(`Ù…Ø±Ø­Ø¨Ø§Ù‘ ${message.author.username}!`, `ÙŠØ±Ø¬Ù‰ Ù…Ø­Ø§ÙˆÙ„Ø© Ø´Ø±Ø­ Ø³Ø¨Ø¨ ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ø£ÙƒØ¨Ø± Ù‚Ø¯Ø± Ù…Ù…ÙƒÙ† Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„. Ø³ÙŠÙƒÙˆÙ† ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ù„Ø¯ÙŠÙ†Ø§ Ù‚Ø±ÙŠØ¨Ø§ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.`)
                .setTimestamp();
            c.send({
                embed: embed
            });
        }).catch(console.error);
    }
 
 
  if (message.content.startsWith(".close")) {
        if (!message.channel.name.startsWith(`ticket-`)) return message.channel.send(`You can't use the close command outside of a ticket channel.`);
 
        message.channel.send(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯ ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¹ÙƒØ³ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!\n Ù„Ù„ØªØ£ÙƒÙŠØ¯ ØŒ Ø§ÙƒØªØ¨\`.confirm\`. Ø³ÙŠØ¤Ø¯ÙŠ Ø°Ù„Ùƒ Ø¥Ù„Ù‰ Ù…Ù‡Ù„Ø© Ø²Ù…Ù†ÙŠØ© ÙÙŠ ØºØ¶ÙˆÙ† 10 Ø«ÙˆØ§Ù†Ù ÙˆØ¥Ù„ØºØ§Ø¦Ù‡Ø§`)
            .then((m) => {
                message.channel.awaitMessages(response => response.content === '.confirm', {
                        max: 1,
                        time: 10000,
                        errors: ['time'],
                    })   
                    .then((collected) => {
                        message.channel.delete();
                    })    
                    .catch(() => {
                        m.edit('Ticket close timed out, the ticket was not closed.').then(m2 => {
                            m2.delete();
                        }, 3000);
                    });
            });
    }
 
});
client.on('message', message => {
if (message.content.split(' ')[0] == '.bc')
 message.guild.members.forEach( member => {
         if (!message.member.hasPermission("ADMINISTRATOR"))  return;
member.send( `${member} ` + "**" + message.content.substr(3));
                                                            message.delete();
															
});
});
client.login(process.env.BOT_TOKEN);
